<!DOCTYPE html>
<html>
  <head>
    <title>Quest3S Labs</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/n5ro/aframe-physics-system@v4.0.1/dist/aframe-physics-system.min.js"></script>
  </head>
  <body>
    <a-scene physics="gravity: -9.8; debug: false">
      <!-- Floor with physics -->
      <a-plane rotation="-90 0 0" width="20" height="20" color="#222" static-body></a-plane>

      <!-- Sky -->
      <a-sky color="#111"></a-sky>

      <!-- Camera Rig -->
      <a-entity id="rig" position="0 1.6 0">
        <a-entity camera look-controls></a-entity>

        <!-- Tiny cube for left controller -->
        <a-box id="leftCube" position="0 0 0" color="red" depth="0.1" height="0.1" width="0.1" kinematic-body></a-box>

        <!-- Tiny cube for right controller -->
        <a-box id="rightCube" position="0 0 0" color="blue" depth="0.1" height="0.1" width="0.1" kinematic-body></a-box>

        <!-- Hand entities (hidden) -->
        <a-entity id="leftHand" laser-controls="hand: left" visible="false"></a-entity>
        <a-entity id="rightHand" laser-controls="hand: right" visible="false"></a-entity>
      </a-entity>

      <script>
        const leftHand = document.querySelector('#leftHand');
        const rightHand = document.querySelector('#rightHand');
        const leftCube = document.querySelector('#leftCube');
        const rightCube = document.querySelector('#rightCube');

        // Move tiny cubes with controllers
        AFRAME.registerComponent('cube-controller', {
          tick: function () {
            leftCube.object3D.position.copy(leftHand.object3D.position);
            leftCube.object3D.rotation.copy(leftHand.object3D.rotation);

            rightCube.object3D.position.copy(rightHand.object3D.position);
            rightCube.object3D.rotation.copy(rightHand.object3D.rotation);
          }
        });

        document.querySelector('a-scene').setAttribute('cube-controller', '');

        // Spawn dynamic cubes at right hand on trigger press
        AFRAME.registerComponent('spawn-cube', {
          init: function () {
            const sceneEl = this.el;
            const right = rightHand;

            // Listen for trigger press
            right.addEventListener('triggerdown', () => {
              const cube = document.createElement('a-box');
              cube.setAttribute('position', right.object3D.position);
              cube.setAttribute('depth', 0.1);
              cube.setAttribute('height', 0.1);
              cube.setAttribute('width', 0.1);
              cube.setAttribute('color', '#00ff00');
              cube.setAttribute('dynamic-body', '');
              sceneEl.appendChild(cube);
            });
          }
        });

        document.querySelector('a-scene').setAttribute('spawn-cube', '');
      </script>
    </a-scene>
  </body>
</html>
